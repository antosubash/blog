---
title: "Setup Cloudflare DNS for AKS Cluster with Terraform"
excerpt: "In this we will setup Cloudflare DNS for AKS Cluster with Terraform"
date: "2023-08-19T11:53:48.157Z"
videoId:
series: "Azure Kubernetes (AKS) Deployment for .Net"
part: 3
tags: ["aks", "kubernetes", "terraform", "cloudflare"]
---

## Table of Contents

## Introduction

In this article we will setup Cloudflare DNS for AKS Cluster with Terraform.

## Prerequisite

Make sure you have completed the previous article and have the following resources created.

- Azure Kubernetes Cluster
- Azure Container Registry
- CertManager for Kubernetes
- Ingress Controller for Kubernetes
- Cloudflare Account

## Setup Cloudflare DNS for AKS Cluster with Terraform

### Update Terraform Variables

Update the `terraform.tfvars` file with the following values.

```terraform
variable "cloudflare_domain_name" {
  default     = ""
  description = "The domain name to use for Let's Encrypt."
  type        = string

  validation {
    condition     = can(regex("^[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$", var.cloudflare_domain_name))
    error_message = "The cloudflare_domain_name variable must be a valid domain name."
  }
}

variable "cloudflare_zone_id" {
  default     = ""
  description = "The Cloudflare Zone ID for the domain name."
  type        = string

  validation {
    condition     = length(var.cloudflare_zone_id) > 0
    error_message = "The cloudflare_zone_id variable must be a valid Cloudflare Zone ID."
  }
}

variable "cloudflare_api_token" {
  default    = ""
  description = "The Cloudflare API Token for the domain name."
  type        = string

  validation {
    condition     = length(var.cloudflare_api_token) > 0
    error_message = "The cloudflare_api_token variable must be a valid Cloudflare API Token."
  }
}
```

This will be used to create the Cloudflare DNS records. The `cloudflare_domain_name` is the domain name that you have registered with Cloudflare. The `cloudflare_zone_id` is the Zone ID for the domain name. The `cloudflare_api_token` is the API Token for the domain name. You can get the Zone ID and API Token from the Cloudflare dashboard.

## Create Cloudflare DNS Records

Create a new file `cloudflare.tf` and add the following code.

```terraform
resource "cloudflare_record" "aks" {
  zone_id = var.cloudflare_zone_id
  name    = "aks"
  value   = azurerm_kubernetes_cluster.aks.fqdn
  type    = "CNAME"
  ttl     = 1
  proxied = true
}
```